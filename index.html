<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Price Board</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* Apply the Vazirmatn font */
        body {
            font-family: 'Vazirmatn', sans-serif;
        }

        /* Style for the main container to enforce a 9:16 aspect ratio */
        .phone-screen {
            width: 100%;
            max-width: 405px; /* Adjust this to make the screenshot bigger or smaller */
            aspect-ratio: 9 / 16;
            margin: auto;
            box-shadow: 0px 0px 30px rgba(0,0,0,0.4);
            display: flex; /* Use flex to make the child fill the height */
            flex-direction: column;
        }
        
        .panel-content {
            flex-grow: 1; /* Allow the main content to grow */
            display: flex;
            flex-direction: column;
        }

        /* Colors for price changes */
        .text-positive { color: #166534; } /* Dark Green */
        .text-negative { color: #991b1b; } /* Dark Red */
        .text-neutral { color: #57534e; } /* Stone */

        .site-left {
            text-align: left;
            color: darkgreen;
        }
        
        /* Subtle background texture for the golden panel */
        .subtle-texture {
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.07), rgba(255, 255, 255, 0)),
                radial-gradient(at top center, rgba(255,255,255,0.2), transparent 70%),
                linear-gradient(45deg, rgba(0,0,0,0.02) 25%, transparent 25%),
                linear-gradient(-45deg, rgba(0,0,0,0.02) 25%, transparent 25%);
            background-size: 100% 100%, 100% 100%, 10px 10px, 10px 10px;
        }

        /* Animation for when data updates */
        .flash {
            animation: flash-animation 0.7s ease-out;
        }
        @keyframes flash-animation {
            0% { background-color: rgba(255, 255, 255, 0.4); }
            100% { background-color: transparent; }
        }
    </style>
</head>

<body class="bg-[#0c1f1a] flex items-center justify-center min-h-screen py-10">

    <div class="phone-screen">
        <div class="w-full h-full bg-gradient-to-b from-[#dcc390] to-[#e7920d] rounded-3xl p-5 flex flex-col text-[#3a3221] subtle-texture panel-content">
            
            <div class="flex justify-center items-center pt-2 pb-4">
                <div>
                    <img src="colored-logo(7).png" alt="ZARSAHAM.COM" width="120" height="120" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                    <div style="display:none;" class="font-bold text-[#166534] text-2xl">ZARSAHAM.COM</div>
                </div>
            </div>

            <div id="data-container" class="flex-grow flex flex-col">
                <div class="flex-grow">
                    <div class="grid grid-cols-3 text-center text-base font-bold pb-2 border-b-2 border-[#bca37c]/50 mb-2">
                        <span class="text-right">نرخ سکه</span>
                        <span>خرید</span>
                        <span>فروش</span>
                    </div>

                    <div id="coin-rows" class="space-y-3 text-base font-medium">
                        </div>
                </div>

                <div class="flex justify-center items-center gap-x-4 my-6 font-bold text-lg">
                    <div id="time-display" class="bg-[#f0e6d2]/70 px-5 py-2 rounded-lg shadow-md backdrop-blur-sm">--:--</div>
                    <div id="date-display" class="bg-[#f0e6d2]/70 px-5 py-2 rounded-lg shadow-md backdrop-blur-sm">----/--/--</div>
                </div>

                <div class="flex-grow">
                    <div class="grid grid-cols-2 text-base font-bold pb-2 border-b-2 border-[#bca37c]/50 mb-2">
                        <span class="text-right">نرخ</span>
                        <span class="text-center">قیمت</span>
                    </div>
                    <div id="other-rows" class="space-y-3 text-base font-medium">
                        </div>
                </div>
            </div>

            <div class="site-left pt-4 mt-auto">
                <span class="font-bold">WWW.ZARSAHAM.COM</span>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_URL = 'https://api.zarsaham.com/api/Portal/GoldPanel';
            
            const coinContainer = document.getElementById('coin-rows');
            const otherContainer = document.getElementById('other-rows');
            const dataContainer = document.getElementById('data-container');

            // --- MAPPING CONFIGURATION ---
            // Map API titles to the display names and IDs for easy access.
            const coinMapping = [
                { apiTitle: 'سکه امامی', displayName: 'سکه امامی (جدید)', id: 'emami' },
                { apiTitle: 'سکه بهار آزادی', displayName: 'تمام بهار آزادی', id: 'bahar' },
                { apiTitle: 'نیم سکه', displayName: 'نیم سکه', id: 'nim' },
                { apiTitle: 'ربع سکه', displayName: 'ربع سکه', id: 'rob' },
                { apiTitle: 'طلای 18 عیار / 750', displayName: 'طلا 18', id: 'gold18' }
            ];

            const otherMapping = [
                { apiTitle: 'دلار', displayName: 'دلار آمریکا', id: 'usd', source: 'SubItems' },
                { apiTitle: 'یورو', displayName: 'یورو', id: 'eur', source: 'SubItems' },
                { apiTitle: 'مثقال طلا', displayName: 'مثقال طلا', id: 'mesghal', source: 'MainItems' },
                { apiTitle: 'طلای 24 عیار', displayName: 'طلا ۲۴ عیار', id: 'gold24', source: 'MainItems' }
            ];

            // Helper function to format numbers with Persian commas
            const formatPrice = (price) => {
                if (typeof price !== 'number') return '...';
                return price.toLocaleString('fa-IR');
            };

            // Helper to get color and symbol for change
            const getChangeInfo = (changeStr, isNegative) => {
                const changeNum = parseFloat(changeStr);
                if (changeNum > 0) return { class: 'text-positive', symbol: '▲' };
                if (changeNum < 0) return { class: 'text-negative', symbol: '▼' };
                return { class: 'text-neutral', symbol: '' };
            };
            
            const createInitialRows = () => {
                let coinHtml = '';
                coinMapping.forEach(item => {
                    coinHtml += `
                        <div class="grid grid-cols-3 items-center">
                            <div class="flex items-center text-right">
                                <svg width="22" height="22" viewBox="0 0 24 24" class="ml-3 drop-shadow-sm"><defs><radialGradient id="gold" cx="0.5" cy="0.5" r="0.5"><stop offset="0%" stop-color="#fff7b2"/><stop offset="100%" stop-color="#e6c134"/></radialGradient></defs><circle cx="12" cy="12" r="11" fill="url(#gold)"/><circle cx="12" cy="12" r="8" fill="none" stroke="#a98a3d" stroke-width="1.5"/></svg>
                                <span>${item.displayName}</span>
                            </div>
                            <span class="text-center" id="${item.id}-buy">...</span>
                            <div class="text-center" id="${item.id}-sell-container">
                                <span id="${item.id}-sell">...</span>
                                <span id="${item.id}-change" class="text-xs font-mono ml-1"></span>
                            </div>
                        </div>`;
                });
                coinContainer.innerHTML = coinHtml;

                let otherHtml = '';
                otherMapping.forEach(item => {
                    otherHtml += `
                        <div class="grid grid-cols-2 items-center">
                            <div class="flex items-center text-right">
                                <svg width="22" height="22" viewBox="0 0 24 24" class="ml-3 drop-shadow-sm"><circle cx="12" cy="12" r="11" fill="url(#gold)"/><circle cx="12" cy="12" r="8" fill="none" stroke="#a98a3d" stroke-width="1.5"/></svg>
                                <span>${item.displayName}</span>
                            </div>
                            <div class="text-center" id="${item.id}-container">
                                <span id="${item.id}-price">...</span>
                                <span id="${item.id}-change" class="text-xs font-mono ml-1"></span>
                            </div>
                        </div>`;
                });
                otherContainer.innerHTML = otherHtml;
            };

            // Main function to fetch data and update the UI
            const fetchAndUpdateData = async () => {
                try {
                    const response = await fetch(API_URL);
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }
                    const data = await response.json();

                    // Update Coin Rows
                    coinMapping.forEach(mapItem => {
                        const apiItem = data.MainItems.find(item => item.Title.includes(mapItem.apiTitle));
                        if (apiItem) {
                            const sellPrice = apiItem.Price;
                            // Assumption: Buy price is slightly lower than the sell price
                            const buyPrice = Math.round(sellPrice * 0.99); 
                            const changeInfo = getChangeInfo(apiItem.Change, apiItem.IsNegative);

                            document.getElementById(`${mapItem.id}-buy`).textContent = formatPrice(buyPrice);
                            document.getElementById(`${mapItem.id}-sell`).textContent = formatPrice(sellPrice);
                            const changeEl = document.getElementById(`${mapItem.id}-change`);
                            changeEl.textContent = `${changeInfo.symbol}${apiItem.Change}%`;
                            changeEl.className = `text-xs font-mono ml-1 ${changeInfo.class}`;
                        }
                    });

                    // Update Other Rows
                    otherMapping.forEach(mapItem => {
                        const sourceArray = mapItem.source === 'SubItems' ? data.SubItems : data.MainItems;
                        const apiItem = sourceArray.find(item => item.Title.includes(mapItem.apiTitle));
                         if (apiItem) {
                            const changeInfo = getChangeInfo(apiItem.Change, apiItem.IsNegative);
                            
                            document.getElementById(`${mapItem.id}-price`).textContent = formatPrice(apiItem.Price);
                            const changeEl = document.getElementById(`${mapItem.id}-change`);
                            changeEl.textContent = `${changeInfo.symbol}${apiItem.Change}%`;
                            changeEl.className = `text-xs font-mono ml-1 ${changeInfo.class}`;
                         }
                    });
                    
                    // Flash animation to indicate data has been updated
                    dataContainer.classList.remove('flash');
                    // This forces a reflow, allowing the animation to be re-triggered
                    void dataContainer.offsetWidth; 
                    dataContainer.classList.add('flash');

                } catch (error) {
                    console.error("Failed to fetch gold prices:", error);
                    coinContainer.innerHTML = `<div class="text-center text-negative col-span-3">${error.message}. Could not load data.</div>`;
                    otherContainer.innerHTML = '';
                }
            };

            // Function to update date and time
            const updateDateTime = () => {
                const now = new Date();
                
                // Time (HH:MM)
                const timeElement = document.getElementById('time-display');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                timeElement.textContent = `${hours}:${minutes}`;

                // Date (Jalali format)
                const dateElement = document.getElementById('date-display');
                // 'fa-IR' locale with 'u-nu-latn' extension gives the desired YYYY/MM/DD format
                dateElement.textContent = now.toLocaleDateString('fa-IR-u-nu-latn').replace(/ /g, '');
            };

            // --- INITIALIZATION ---
            createInitialRows(); // Build the table structure
            updateDateTime();   // Update date/time immediately
            fetchAndUpdateData(); // Fetch data immediately

            // --- SET INTERVALS ---
            // Refresh data every 1 minute (60,000 milliseconds)
            setInterval(fetchAndUpdateData, 60000);
            // Refresh time every 1 minute
            setInterval(updateDateTime, 60000);
        });
    </script>

</body>
</html>